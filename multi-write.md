## `[multi-write]` Атомарная запись в `n` ячеек

Рассмотрим операцию # Multi-Write`(r1,v1,r2,v2,...,rn,vn)`(r_1, v_1, r_2, v_2, ..., r_n, v_n)(r1​,v1​,r2​,v2​,...,rn​,vn​), которая атомарно записывает значения v1,v2,...,vnv_1, v_2, ..., v_nv1​,v2​,...,vn​ в ячейки r1,r2,...,rnr_1, r_2, ..., r_nr1​,r2​,...,rn​ соответственно. 


Покажите, что Multi-Write в две ячейки памяти позволяет решить консенсус для двух потоков.
Докажите, что Multi-Write в nnn ячеек памяти вместе с обычными точечными чтениями / записями позволяет решить консенсус по крайней мере для nnn потоков.
1) Для двух ячеек, то есть имеем операцию `write(r1, v1, r2, v2)`:
Пусть есть 3 регистра, в которые мы можем писать и в них изначально нули. Потоки `T1` и `T2` делают `write(r1, 1, r3, 1)` и `write(r2, 2, r3, 2)` соответственно. Как определить победителя? Если значение `r1` и `r2` нули, значит никто еще не пришел, если `r1 = 1`, а `r2 = 0` (чтение произведено в том же порядке), то `T1` пришел раньше и он победил. Если нет, прочитаем `r1` снова:
a) Было: `r1 = 0`, `r2 = 2`.
Если после прочтения так и осталось, то `T2` явилс я раньше и победил.
Если нет, и `r1 = 1`, то запись 1 в `r3` произошла позже записи 2, значит также победил второй поток.
b) Было: `r1 = 1, r2 = 2`.
После прочтения `r1` ничего не изменится и победитель определится значением `r3`.

2) Для `n` ячеек, то есть имеем операцию `write(r1, v1, r2, v2,..., rN, vN)`:
Заведем по одному регистру на каждую пару потоков(`r_ij`), а также по регистру для каждого потока(`r_i`). Каждый поток `i` будет писать так: `write(r_i, i, r_{ij_1}, i, ...., r_{ij_{n-1}}, i)`.
То есть он записывает число `i` в свой регистры и все регистры, разделяемые им с другими потоками. Всего запись в `n` регистров.
Далее проводим "турнир": раcматриваем все пары потоков `(i, j)`.
Необходимо посмотреть на регистры `r_i`, `r_j` и `r_ij` и определить победителя по пункту 1 задачи. Так мы выясним поток, который ни разу не проиграл, то есть выиграл в задаче консенсуса.
