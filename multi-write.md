## `[multi-write]` Атомарная запись в `n` ячеек

Рассмотрим операцию `Multi-Write(r1,v1,r2,v2,...,rn,vn)`, которая атомарно записывает значения `v1,v2,...,vn` в ячейки `r1,r2,...,rn` соответственно. 


Покажите, что `Multi-Write` в две ячейки памяти позволяет решить консенсус для двух потоков.
Докажите, что `Multi-Write` в `n` ячеек памяти вместе с обычными точечными чтениями / записями позволяет решить консенсус по крайней мере для `n` потоков.

## Решение:

1) Для начала покажем, что `Multi-Write` в две ячейки памяти позволяет решить консенсус для двух потоков. Для этого рассмотрим 2 какие-либо ячейки памяти. Пусть у нас есть 3 регистра с записанными в ними любыми (!) отрицательными числами. Далее рассмотрим 2 потока:

`первый поток`: `write(r1, 1, r3, 1)`

`второй поток`: `write(r2, 2, r3, 2)`

1. Если в `r1` и `r2` отрицательные числа, значит, ни один поток ещё не дошёл.
2. Если мы считывем в `r1 = 1`, а в `r2` любое отрицательное число, то первый поток пришел раньше.
3. Если условия двух первых пунктов не выполнены, то прочитаем ещё раз в том же порядке две ячейки.

3.1. Если было: в `r1` любое отрицательное число, `r2 = 2`. 

стало: `r1 = 0`, `r2 = 2`,
          
то второй поток пришёл раньше.

3.2. Если было: `r1 = 1, r2 = 2` => определим пришедший раньше поток по `r3`.

2) Теперь докажем, что `Multi-Write` в `n` ячеек памяти вместе с обычными точечными чтениями / записями позволяет решить консенсус по крайней мере для `n` потоков. Для этого нужно завести регистры для каждой пары потоков + по отдельному регистру на каждый поток.
Тогда запись `i-ого` потока будет выглядеть так: `i` записывается в `ri` и во все парные регистры, создающие пару с данным номером потока. Далее раcматриваем все пары потоков. Каждый раз смотрим на отдельные регистры для двух потоков, образующих пару + их совместый регистр. Действуем аналогично первому пункту данной задачи. Так мы сможем найти поток, который победит в задаче консенсуса.

ч.т.д.

